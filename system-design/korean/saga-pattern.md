# 분산 트랜잭션을 위한 사가 패턴

사가 패턴은 분산 트랜잭션을 사용하지 않고 여러 서비스에 걸쳐 데이터 일관성을 관리하는 마이크로서비스 아키텍처 패턴입니다. 이는 서비스 자율성과 데이터베이스 분리로 인해 전통적인 ACID 트랜잭션이 실행 불가능한 분산 시스템에서 특히 유용합니다.

사가는 각 트랜잭션이 단일 서비스 내의 데이터를 업데이트하는 로컬 트랜잭션 시퀀스입니다. 단계가 실패하면 이전에 성공한 단계가 변경한 내용을 취소하기 위해 보상 트랜잭션이 실행됩니다. 이는 리소스를 장시간 잠그지 않고도 최종적인 일관성을 보장합니다.

두 가지 주요 조정 접근 방식이 있습니다: 안무 기반 사가(각 서비스가 다른 서비스가 트랜잭션을 수행하도록 트리거하는 도메인 이벤트를 발행)는 느슨한 결합을 촉진하지만 잠재적으로 모니터링을 복잡하게 만듭니다; 오케스트레이션 기반 사가(중앙 조정자가 참여자를 지시하고 전체 프로세스를 관리)는 더 나은 가시성을 제공하지만 잠재적인 단일 장애 지점을 도입합니다.

사가를 구현할 때 주요 고려 사항으로는 중복 메시지를 처리하기 위한 멱등성 작업 설계, 순서에 관계없이 작동하도록 보상 트랜잭션의 교환법칙 보장, 충돌 후 트랜잭션 복구를 위한 적절한 로깅 구현, 타임아웃 및 알림으로 장기 실행 사가 처리 등이 있습니다.

과제로는 부분 완료 가시성 관리(실행 중에 시스템이 일관성이 없는 것처럼 보일 수 있음), 보상 트랜잭션 실패 처리, 충돌할 수 있는 동시 사가 처리, 서비스 전체에 걸친 사가 실행을 추적하기 위한 적절한 모니터링 구현 등이 있습니다.

사가 패턴은 특히 전통적인 분산 트랜잭션이 실용적이거나 가능하지 않은 클라우드 환경에서 독립적인 데이터베이스를 가진 여러 마이크로서비스에 걸친 작업에 가장 적합합니다.