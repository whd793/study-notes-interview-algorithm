# 멱등성 API 설계

멱등성 API 작업은 호출 횟수에 관계없이 동일한 결과를 생성하며, 이는 재시도와 중복 요청을 안전하게 처리할 수 있는 신뢰할 수 있는 시스템을 구축하는 데 중요합니다. 멱등성은 네트워크 문제, 타임아웃 또는 클라이언트 재시도가 발생하더라도 일관된 시스템 상태를 보장합니다.

HTTP 메서드는 서로 다른 멱등성 특성을 가집니다: GET, HEAD, PUT, DELETE는 HTTP 사양에 따라 멱등적이어야 하는 반면, POST는 일반적으로 비멱등적입니다. 자연적으로 비멱등적인 작업을 멱등적으로 만들기 위해서는 명시적인 설계가 필요합니다.

일반적인 구현 전략으로는 멱등성 키(각 요청과 함께 포함되는 클라이언트 생성 고유 식별자)가 있으며, 서버는 완료된 작업 ID를 저장하고 중복을 거부합니다; ETags와 함께 If-Match 또는 If-None-Match 헤더를 사용한 조건부 요청으로 의도하지 않은 업데이트를 방지합니다; 최근 작업을 감지하여 중복을 감지하기 위해 특정 시간 동안 추적하는 중복 제거 창이 있습니다.

상태 변경 작업의 경우, 설계는 작업 멱등성보다 효과 멱등성에 중점을 두어야 합니다 - 여러 호출이 내부적으로 다르게 처리될 수 있지만 동일한 최종 시스템 상태를 초래해야 합니다. 데이터베이스 트랜잭션은 업서트 작업이나 조건부 업데이트를 사용하여 이를 구현할 수 있습니다.

실용적인 고려 사항으로는 멱등성 레코드에 대한 적절한 보존 기간 결정, 스토리지 정리 처리, 클라이언트가 멱등성 키를 적절하게 생성하도록 보장(일반적으로 UUID v4 사용), API 사양에 멱등성 보장을 명확하게 문서화하는 것이 포함됩니다.

멱등성 구현은 복잡성을 추가하지만 미션 크리티컬한 작업, 특히 최종 일관성이 있는 분산 시스템이나 네트워크 불안정성이 있는 환경에서는 필수적입니다. 적절한 멱등 설계는 데이터 손상, 중복 레코드, 그리고 수동 개입이 필요한 일관성 없는 상태를 방지합니다.